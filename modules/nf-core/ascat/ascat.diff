Changes in component 'nf-core/ascat'
'modules/nf-core/ascat/meta.yml' is unchanged
Changes in 'ascat/main.nf':
--- modules/nf-core/ascat/main.nf
+++ modules/nf-core/ascat/main.nf
@@ -4,11 +4,12 @@
 
     conda "${moduleDir}/environment.yml"
     container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        'https://depot.galaxyproject.org/singularity/mulled-v2-c278c7398beb73294d78639a864352abef2931ce:ba3e6d2157eac2d38d22e62ec87675e12adb1010-0':
-        'biocontainers/mulled-v2-c278c7398beb73294d78639a864352abef2931ce:ba3e6d2157eac2d38d22e62ec87675e12adb1010-0' }"
+        'https://depot.galaxyproject.org/singularity/mulled-v2-c278c7398beb73294d78639a864352abef2931ce:03f4a075e359bb32a613b098d13dba7b4c8c967f-0':
+        'biocontainers/mulled-v2-c278c7398beb73294d78639a864352abef2931ce:03f4a075e359bb32a613b098d13dba7b4c8c967f-0' }"
 
     input:
     tuple val(meta), path(input_normal), path(index_normal), path(input_tumor), path(index_tumor)
+    val(genomeVersion)
     path(allele_files)
     path(loci_files)
     path(bed_file)  // optional
@@ -23,8 +24,10 @@
     tuple val(meta), path("*LogR.txt"),                        emit: logrs
     tuple val(meta), path("*metrics.txt"),                     emit: metrics
     tuple val(meta), path("*png"),                             emit: png
+    tuple val(meta), path("*pdf"),                             emit: pdf, optional: true
     tuple val(meta), path("*purityploidy.txt"),                emit: purityploidy
     tuple val(meta), path("*segments.txt"),                    emit: segments
+    tuple val(meta), path("*segments_raw.txt"),                emit: segments_raw
     path "versions.yml",                                       emit: versions
 
     when:
@@ -34,9 +37,9 @@
     def args           = task.ext.args        ?: ''
     def prefix         = task.ext.prefix      ?: "${meta.id}"
     def gender         = args.gender          ?  "$args.gender" :        "NULL"
-    def genomeVersion  = args.genomeVersion   ?  "$args.genomeVersion" : "NULL"
     def purity         = args.purity          ?  "$args.purity" :        "NULL"
     def ploidy         = args.ploidy          ?  "$args.ploidy" :        "NULL"
+    def penalty        = args.penalty         ?  "$args.penalty" :       "NULL"
     def gc_input       = gc_file              ?  "$gc_file" :            "NULL"
     def rt_input       = rt_file              ?  "$rt_file" :            "NULL"
 
@@ -48,7 +51,12 @@
     def fasta_arg                        = fasta                              ?  ",ref.fasta = '$fasta'" : ""
     def skip_allele_counting_tumour_arg  = args.skip_allele_counting_tumour   ?  ",skip_allele_counting_tumour = $args.skip_allele_counting_tumour" : ""
     def skip_allele_counting_normal_arg  = args.skip_allele_counting_normal   ?  ",skip_allele_counting_normal = $args.skip_allele_counting_normal" : ""
-
+    
+    def normal_exists                    = input_normal                       ? 'TRUE' : 'FALSE'
+    def normal_bam                       = input_normal                       ? ",normalseqfile = '$input_normal'" : ""
+    def normal_name                      = input_normal                       ? ",normalname = '${prefix}.normal'" : ""
+    def longread_bins                    = args.longread_bins                 ? ",loci_binsize = $args.longread_bins" : ""
+    def allele_counter_flags             = args.allele_counter_flags          ? ",additional_allelecounter_flags = '$args.allele_counter_flags'" : "" 
     """
     #!/usr/bin/env Rscript
     library(RColorBrewer)
@@ -65,21 +73,23 @@
     #prepare from BAM files
     ascat.prepareHTS(
         tumourseqfile = "$input_tumor",
-        normalseqfile = "$input_normal",
         tumourname = paste0("$prefix", ".tumour"),
-        normalname = paste0("$prefix", ".normal"),
         allelecounter_exe = "alleleCounter",
         alleles.prefix = allele_prefix,
         loci.prefix = loci_prefix,
         gender = "$gender",
         genomeVersion = "$genomeVersion",
         nthreads = $task.cpus
+        $normal_bam
+        $normal_name
         $minCounts_arg
         $bed_file_arg
         $chrom_names_arg
         $min_base_qual_arg
         $min_map_qual_arg
+        $longread_bins
         $fasta_arg
+        $allele_counter_flags
         $skip_allele_counting_tumour_arg
         $skip_allele_counting_normal_arg,
         seed = 42
@@ -87,37 +97,55 @@
 
 
     #Load the data
-    ascat.bc = ascat.loadData(
-        Tumor_LogR_file = paste0("$prefix", ".tumour_tumourLogR.txt"),
-        Tumor_BAF_file = paste0("$prefix", ".tumour_tumourBAF.txt"),
-        Germline_LogR_file = paste0("$prefix", ".tumour_normalLogR.txt"),
-        Germline_BAF_file = paste0("$prefix", ".tumour_normalBAF.txt"),
-        genomeVersion = "$genomeVersion",
-        gender = "$gender"
-    )
+    if($normal_exists) {
+        print("normal exists")
+        ascat.bc = ascat.loadData(
+            Tumor_LogR_file = paste0("$prefix", ".tumour_tumourLogR.txt"),
+            Tumor_BAF_file = paste0("$prefix", ".tumour_tumourBAF.txt"),
+            Germline_LogR_file = paste0("$prefix", ".tumour_normalLogR.txt"),
+            Germline_BAF_file = paste0("$prefix", ".tumour_normalBAF.txt"),
+            genomeVersion = "$genomeVersion",
+            gender = "$gender"
+        )
+    } else {
+        print("normal does not exist")
+        ascat.bc = ascat.loadData(
+            Tumor_LogR_file = paste0("$prefix", ".tumour_tumourLogR.txt"),
+            Tumor_BAF_file = paste0("$prefix", ".tumour_tumourBAF.txt"),
+            genomeVersion = "$genomeVersion",
+            gender = "$gender")
+        gg = ascat.predictGermlineGenotypes(ascat.bc, platform = "WGS_hg38_50X")
+        
+    }
+    print("printing ascat.bc")
+    print(ascat.bc)
 
     #Plot the raw data
     ascat.plotRawData(ascat.bc, img.prefix = paste0("$prefix", ".before_correction."))
 
     # optional LogRCorrection
     if("$gc_input" != "NULL") {
-        gc_input = paste0(normalizePath("$gc_input"), "/", "$gc_input", ".txt")
+        gc_input = paste0(normalizePath("$gc_input"))
 
         if("$rt_input" != "NULL"){
-            rt_input = paste0(normalizePath("$rt_input"), "/", "$rt_input", ".txt")
+            rt_input = paste0(normalizePath("$rt_input"))
             ascat.bc = ascat.correctLogR(ascat.bc, GCcontentfile = gc_input, replictimingfile = rt_input)
             #Plot raw data after correction
             ascat.plotRawData(ascat.bc, img.prefix = paste0("$prefix", ".after_correction_gc_rt."))
         }
         else {
-            ascat.bc = ascat.correctLogR(ascat.bc, GCcontentfile = gc_input, replictimingfile = $rt_input)
+            ascat.bc = ascat.correctLogR(ascat.bc, GCcontentfile = gc_input)
             #Plot raw data after correction
             ascat.plotRawData(ascat.bc, img.prefix = paste0("$prefix", ".after_correction_gc."))
         }
     }
 
     #Segment the data
-    ascat.bc = ascat.aspcf(ascat.bc, seed=42)
+    if($normal_exists) {
+        ascat.bc = ascat.aspcf(ascat.bc, seed=42, penalty = $penalty)
+    } else {
+        ascat.bc = ascat.aspcf(ascat.bc, seed=42, penalty = $penalty, ascat.gg = gg)
+    }
 
     #Plot the segmented data
     ascat.plotSegmentedData(ascat.bc)

'modules/nf-core/ascat/environment.yml' is unchanged
************************************************************
